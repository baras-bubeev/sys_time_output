# sys_time_output
## TASM 5.0
### Task:
Display the system time "hours:minutes:seconds" every second in the upper right corner of the screen.
### Description:
  The `old` identifier defines a 4-byte memory cell that stores the address of the old timer interrupt handler. This cell will be needed when the old timer interrupt handler is called. The identifier `buf` defines a pattern to form a string containing the current time value in the format "hours:minutes:seconds". The last byte in the pattern is zero, needed to determine the length of the pattern.<br/>
  
  The `decode` procedure converts the binary-decimal number in the AL register into two ASCII characters corresponding to the value of hours, minutes, or seconds (this depends on the specific value written in the AL register). The procedure adds an ASCII code of the '0' character to the digit value of the number (the lowest digit being in the first four bits of the AL register, the highest being in the highest four bits), thus forming an ASCII code for the digit of the lowest or highest digit. This ASCII code is then written to the current position of the pattern. After writing to the pattern, the value of the pointer to the current pattern character is incremented by 3 (two digits for hours, minutes or seconds, plus the ':' character).<br/>
  
  The procedure `clock` is a timer interrupt handler. The thing is that the number of the hardware timer interrupt handler is 08h. But in the system interrupt handler of this hardware interrupt there is a call of INT 1Ch. The interrupt 1Ch defines the user interrupt handler from the timer which is called by the system one. Thus, the cell `old` stores the address of the old user interrupt handler from the timer. At the beginning of the `clock` procedure the PUSHF command prepares the structure for the IRET command in the stack and then the old user timer interrupt handler is called. Then in the `clock` procedure all modifiable registers (including segment registers) are saved in the stack. After that the segment register DS is initialized for further reference to the memory cells of the resident part of the program. The next step is to get the value of the current time from the BIOS using interrupt BIOS 1Ah. After calling the INT 1Ah instruction, the CH register holds the value of hours, the CL register holds the value of minutes, and the DH register holds the value of seconds. Each value is represented in binary-decimal format - the lowest digit of the number is in the lower four bits of the register and the highest digit of the number - in the upper four bits. After receiving the value of the current time the register BX is set to the beginning of the template to write to the template values of hours, minutes and seconds. Then the procedure `decode` is called three times to write to the template hours, minutes and seconds respectively. After the necessary information is written to the template, the template characters are displayed in the upper right corner of the screen. To do this the ES register is set to the video memory segment, and the DI register is assigned the value 140. Next in the loop is the output to the video memory of the template characters and attributes. After that the values of all registers modified by the procedure are restored and the IRET command returns from the handler.<br/>
  
  In the main part of the program the address of the old user interrupt handler from the timer (interrupt 1Ch) is retrieved with the DOS 35h function. The segment and offset values of the old handler are written into the `old` cell. Next, the address of our timer interrupt handler is set. To do this, the offset of our handler is written into the DX register (the offset of the `clock` procedure) and the function DOS 25h is called (register DS already contains the value of the segment of our handler). After that the DOS 31h function is called, which ends the program and saves a part of its code into the memory.<br/>

____

### Задача:
Выводить ежесекундно в правом верхнем углу экрана системное время “часы:минуты:секунды”.
### Описание:
Идентификатор `old` определяет ячейку памяти размером 4 байта, которая хранит адрес старого обработчика прерываний от таймера. Эта ячейка будет нужна, когда будет вызываться старый обработчик прерываний от таймера. Идентификатор `buf` определяет шаблон для формирования строки, содержащей значение текущего времени в формате часы:минуты:секунды. Последний байт в шаблоне - нулевой - нужен для определения длины шаблона.<br/>

Процедура `decode` преобразует двоично-десятичное число в регистре AL в два ASCII символа, соответствующих значению часов, минут или секунд (это зависит от конкретного значения, записанного в регистре AL). Процедура прибавляет к значению разряда числа (младший разряд находится в первых четырёх битах регистра AL, старший - в старших четырёх битах) ASCII код символа '0', тем самым формируя ASCII код для цифры младшего или старшего разряда. Далее этот ASCII код записывается в текущую позицию шаблона. После записи в шаблон значение указателя на текущий символ шаблона увеличивается на 3 (две цифры для часов, минут или секунд, плюс символ ':').<br/>

Процедура `clock` является обработчиком прерываний от таймера. Дело в том, что номер аппаратного обработчика прерываний от таймера - 08h. Но в системном обработчике этого аппаратного прерывания есть вызов INT 1Ch. Прерывание 1Ch определяет пользовательский обработчик прерываний от таймера, который вызывается системным. Таким образом, ячейка `old` хранит адрес старого пользовательского обработчика прерываний от таймера. В начале процедуры `clock` командой PUSHF в стеке подготавливается структура для команды IRET и затем вызывается старый пользовательский обработчик прерываний от таймера. Далее в процедуре `clock` сохраняются в стеке все модифицируемые регистры (в том числе и сегментные). После этого инициализируется сегментный регистр DS для последующего обращения к ячейкам памяти резидентной части программы. Следующим шагом является получение значения текущего времени из BIOS при помощи прерывания BIOS 1Ah. После вызова команды INT 1Ah в регистре CH находится значение часов, в регистре CL - значение минут и в регистре DH - значение секунд. Каждое значение представлено в двоично-десятичном формате - младший разряд числа находится в младших четырёх битах регистра, а старший разряд числа - в старших четырёх битах. После получения значения текущего времени регистр BX настраивается на начало шаблона для записи в шаблон значений часов, минут и секунд. Далее три раза вызывается процедура `decode` для записи в шаблон соответственно часов, минут и секунд. После записи в шаблон необходимой информации происходит вывод символов шаблона в правый верхний угол экрана. Для этого регистр ES настраивается на сегмент видеопамяти, а регистр DI присваивается значение 140. Далее в цикле происходит вывод в видеопамять символов шаблона и атрибутов. После этого восстанавливаются значения всех модифицируемых процедурой регистров и командой IRET происходит возврат из обработчика.<br/>

В основной части программы при помощи функции DOS 35h происходит получение адреса старого пользовательского обработчика прерываний от таймера (прерывание 1Сh). Значения сегмента и смещения старого обработчика записываются в ячейку `old`. Далее устанавливается адрес нашего обработчика прерываний от таймера. Для этого в регистр DX записывается смещение нашего обработчика (смещение процедуры `clock`) и вызывается функция DOS 25h (регистр DS уже содержит значение сегмента нашего обработчика). После этого происходит вызов функции DOS 31h, которая завершает программу и сохраняет часть её кода в памяти.<br/>
