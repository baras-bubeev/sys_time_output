# sys_time_output
TASM 5.0
Task:
Display the system time "hours:minutes:seconds" every second in the upper right corner of the screen.
Description:
The 'old' identifier defines a 4-byte memory cell that stores the address of the old timer interrupt handler. This cell will be needed when the old timer interrupt handler is called. The identifier 'buf' defines a pattern to form a string containing the current time value in the format "hours:minutes:seconds". The last byte in the pattern is zero, needed to determine the length of the pattern.
The 'decode' procedure converts the binary-decimal number in the AL register into two ASCII characters corresponding to the value of hours, minutes, or seconds (this depends on the specific value written in the 'AL' register). The procedure adds an ASCII code of the '0' character to the digit value of the number (the lowest digit being in the first four bits of the AL register, the highest being in the highest four bits), thus forming an ASCII code for the digit of the lowest or highest digit. This ASCII code is then written to the current position of the pattern. After writing to the pattern, the value of the pointer to the current pattern character is incremented by 3 (two digits for hours, minutes or seconds, plus the ':' character).
The procedure 'clock' is a timer interrupt handler. The thing is that the number of the hardware timer interrupt handler is 08h. But in the system interrupt handler of this hardware interrupt there is a call of INT 1Ch. The interrupt 1Ch defines the user interrupt handler from the timer which is called by the system one. Thus, the cell 'old' stores the address of the old user interrupt handler from the timer. At the beginning of the 'clock' procedure the PUSHF command prepares the structure for the IRET command in the stack and then the old user timer interrupt handler is called. Then in the 'clock' procedure all modifiable registers (including segment registers) are saved in the stack. After that the segment register DS is initialized for further reference to the memory cells of the resident part of the program. The next step is to get the value of the current time from the BIOS using interrupt BIOS 1Ah. After calling the INT 1Ah instruction, the CH register holds the value of hours, the CL register holds the value of minutes, and the DH register holds the value of seconds. Each value is represented in binary-decimal format - the lowest digit of the number is in the lower four bits of the register and the highest digit of the number - in the upper four bits. After receiving the value of the current time the register BX is set to the beginning of the template to write to the template values of hours, minutes and seconds. Then the procedure 'decode' is called three times to write to the template hours, minutes and seconds respectively. After the necessary information is written to the template, the template characters are displayed in the upper right corner of the screen. To do this the ES register is set to the video memory segment, and the DI register is assigned the value 140. Next in the loop is the output to the video memory of the template characters and attributes. After that the values of all registers modified by the procedure are restored and the IRET command returns from the handler.
In the main part of the program the address of the old user interrupt handler from the timer (interrupt 1Ch) is retrieved with the DOS 35h function. The segment and offset values of the old handler are written into the 'old' cell. Next, the address of our timer interrupt handler is set. To do this, the offset of our handler is written into the DX register (the offset of the 'clock' procedure) and the function DOS 25h is called (register DS already contains the value of the segment of our handler). After that the DOS 31h function is called, which ends the program and saves a part of its code into the memory.